{% load i18n %}
{% load dossier %}
{% load smart_urls %}

<div control="issue-container" data-id="{{ issue.id }}">
    <div class="panel panel-default" control="issue">
        {% if session_agenda_item %}
            {% include 'core/stub/session_agenda_item_header.html' %}
        {% elif committee_agenda_item %}
            {% include 'core/stub/committee_agenda_item_header.html' %}
        {% elif upcoming_sessions %}
            {% include 'core/stub/issue_upcoming_sessions_header.html' %}
        {% elif upcoming_committee_agendas %}
            {% include 'core/stub/issue_upcoming_committee_agendas_header.html' %}
        {% endif %}
        {% if issue.issue_group == 'A' %}
            <div class="panel-body">
                <p class="pull-right">
                    <span class="label label-default">{{ issue.issue_num }}. {% trans 'parliamentary issue' %}</span>
                    <span class="label label-default">{{ issue.get_issue_type_display|capfirst }}</span>
                </p>
                <p>
                    <a href="{% breadcrumb_url 'parliament_issue' issue.parliament.parliament_num issue.issue_num %}">
                        <strong><span control="issue-name" data-id="{{ issue.id }}">{{ issue }}</span></strong>
                    </a>
                    {% if issue.description %}
                        <small>(<span control="issue-description" data-id="{{ issue.id }}">{{ issue.description }}</span>)</small>
                    {% endif %}
                </p>
                <p class="pull-right">
                    <span class="label label-default">{% trans 'Reviews' %}: {{ issue.review_count }}</span>
                    <span class="label label-default">{% trans "Parliamentary Documents" %}: {{ issue.document_count }}</span>
                </p>
                <p>
                    <small>
                    <strong>{% trans "Proposers" %}:</strong>
                        {% for proposer in issue.proposers.all %}
                            {% if proposer.person %}
                                <a href="{% url 'person' proposer.person.slug proposer.person.subslug %}">{{ proposer }}</a>{% if not forloop.last %}, {% endif %}
                            {% else %}
                                <a href="#">{{ proposer }}</a>{% if not forloop.last %}, {% endif %}
                            {% endif %}
                        {% endfor %}
                    </small>
                </p>
                <p>
                    {% display_dossier_statistics issue %}
                </p>
            </div>
            {% if user.is_authenticated %}
                <div class="panel-footer">
                    {% include 'core/stub/issue_bookmark.html' %}

                    {% if issue.dossier_statistics %}
                        <button control="delete-issue-dossiers" class="btn btn-default btn-xs pull-right" data-session-agenda-item-id="{{ session_agenda_item.id }}" data-id="{{ issue.id }}">{% trans 'Mark as Unopened' %}</button>
                    {% endif %}
                </div>
            {% endif %}
        {% elif issue.issue_group == 'B' %}
            <div class="panel-body"><strong>{{ issue }}</strong></div>
        {% endif %}
    </div>
</div>
